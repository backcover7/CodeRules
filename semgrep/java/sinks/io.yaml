rules:
  - id: io
    options:
      symbolic_propagation: true
    pattern-either:
      - pattern: new java.util.zip.ZipInputStream($D, ...).getNextEntry(...)
      - patterns:
        - pattern: ($CLS $TAR).$METHOD(...)
        - metavariable-regex:
            metavariable: $CLS
            regex: ^org.apache.commons.compress.archivers.(ar.Ar|arj.Arj|cpio.Cpio|dump.Dump|jar.Jar|tar.Tar|zip.Zip|)ArchiveInputStream$
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^get(.*)Entry$
      - patterns:
        - pattern-either:
          - pattern: new org.apache.commons.compress.archivers.ArchiveStreamFactory().createArchiveInputStream($D, ...).$METHOD(...)
          - pattern: new org.apache.commons.compress.archivers.ArchiveStreamFactory().createArchiveInputStream($EXT, $D, ...).$METHOD(...)
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^get(.*)Entry$
    message: Semgrep found a match
    languages:
      - java
    severity: WARNING