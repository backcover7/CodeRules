rules:
  - id: rce
    options:
      symbolic_propagation: true
    pattern-either:
      - patterns:
        - pattern: Runtime.getRuntime().$METHOD(...)
        - metavariable-regex:
            metavariable: $METHOD
            regex: exec|loadLibrary|load
      - pattern: new ProcessBuilder(...)
      - pattern: (ProcessBuilder $PB).command(...)
      - pattern: (org.apache.commons.exec.CommandLine $CL).parse(...)
      - pattern: (java.lang.reflect.Method $METHOD).invoke(...)
      - pattern: (Class $CLS).newInstance(...)
      - pattern: (ClassLoader $CLS)
      - pattern: (java.net.ClassLoader $CLS)
      - patterns:
        - pattern: (ClassLoader $CL).$METHOD(...)
        - metavariable-regex:
            metavariable: $METHOD
            regex: ClassLoader|defineClass|loadClass
      - pattern: (URLClassLoader $CLS)
      - pattern: (java.net.URLClassLoader $CLS)
      - patterns:
        - pattern: (java.net.URLClassLoader $CL).$METHOD(...)
        - metavariable-regex:
            metavariable: $METHOD
            regex: newInstance|MLet
      - pattern: (java.awt.Desktop $DESKTOP).browse(...);
      - pattern: java.awt.Desktop.getDesktop().browse(...);
    message: Semgrep found a match
    languages:
      - java
    severity: WARNING