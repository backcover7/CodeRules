rules:
  - id: xss
    options:
      symbolic_propagation: true
    patterns:
      - pattern-either:
        - patterns:
          - pattern: ($JDKIO $W).$METHOD(...)
          - metavariable-regex:
              metavariable: $JDKIO
              regex: java\.io\..*
        - patterns:
          - pattern: $INSTANCE. ... .$METHOD(...)
          - metavariable-pattern:
              metavariable: $INSTANCE
              pattern-either:
                - pattern: (javax.servlet.jsp.JspContext $CTX). ... .getOut()
                - pattern: (javax.servlet.jsp.PageContext $CTX). ... .getOut()  # inherited from class JspContext
                - pattern: (javax.servlet.ServletRequest $SERVLET).getWriter(...)
                - pattern: (javax.servlet.http.HttpServletRequest $SERVLET).getWriter(...)   # inherited from class ServletRequest
                - pattern: (javax.servlet.ServletRequest $SERVLET).getOutputStream(...)
                - pattern: (javax.servlet.http.HttpServletRequest $SERVLET).getOutputStream(...)   # inherited from class ServletRequest
                - pattern: (jakarta.servlet.jsp.JspContext $CTX). ... .getOut()
                - pattern: (jakarta.servlet.jsp.PageContext $CTX). ... .getOut()  # inherited from class JspContext
                - pattern: (jakarta.servlet.ServletRequest $SERVLET).getWriter(...)
                - pattern: (jakarta.servlet.http.HttpServletRequest $SERVLET).getWriter(...)   # inherited from class ServletRequest
                - pattern: (jakarta.servlet.ServletRequest $SERVLET).getOutputStream(...)
                - pattern: (jakarta.servlet.http.HttpServletRequest $SERVLET).getOutputStream(...)   # inherited from class ServletRequest
                - pattern: (javax.faces.context.FacesContext $CTX).getResponseWriter(...)
                - pattern: (jakarta.faces.context $CTX).getResponseWriter(...)
                - pattern: (javax.faces.context.FacesContext $CTX).getResponseStream(...)
                - pattern: (jakarta.faces.context $CTX).getResponseStream(...)
                - pattern: javax.faces.context.ResponseWriter
                - pattern: javax.faces.context.ResponseStream
                - pattern: jakarta.faces.context.ResponseWriter
                - pattern: jakarta.faces.context.ResponseStream
        - pattern: (org.apache.batik.swing.svg.JSVGComponent $JSVGC).loadSVGDocument($URL)
      - metavariable-regex:
          metavariable: $METHOD
          regex: ^(print.*|append|format|write)$
    message: Semgrep found a match related to XSS injection
    severity: WARNING
    languages:
      - java